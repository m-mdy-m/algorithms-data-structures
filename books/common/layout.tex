\usepackage[
a4paper,
top=2.5cm,
bottom=2.5cm,
inner=3cm,           % Larger inner margin for binding
outer=2.5cm,         % Balanced outer margin
headheight=1.2cm,    % Space for elaborate headers
headsep=0.8cm,       % Separation between header and text
footskip=1cm,        % Space for footers
marginparwidth=2cm,  % Margin notes width
marginparsep=0.3cm   % Separation for margin notes
]{geometry}

%----------------------------------------------
% Line Spacing and Typography
%----------------------------------------------
\usepackage{setspace}
\setstretch{1.25}  
\setlength{\parindent}{1.5em} 
\setlength{\parskip}{0.4ex plus 0.2ex minus 0.1ex}
\tolerance=2000                     % Allow more flexible line breaking
\hbadness=1000                     % Suppress minor overfull warnings
\emergencystretch=15pt             % Emergency stretch for difficult paragraphs
%----------------------------------------------
% Float Positioning and Control
%----------------------------------------------
\usepackage{float}                 % Enhanced float positioning
\usepackage{placeins}              % Float barriers
\usepackage{afterpage}             % Execute commands after page breaks
% Float placement preferences
\renewcommand{\topfraction}{0.85}          % Max fraction of page for top floats
\renewcommand{\bottomfraction}{0.70}       % Max fraction of page for bottom floats
\renewcommand{\textfraction}{0.1}         % Min fraction of page for text
\renewcommand{\floatpagefraction}{0.8}    % Min fraction for float-only pages
\setcounter{topnumber}{3}                  % Max top floats per page
\setcounter{bottomnumber}{2}               % Max bottom floats per page
\setcounter{totalnumber}{5}                % Max floats per page

%----------------------------------------------
% List and Enumeration Spacing
%----------------------------------------------
\usepackage{enumitem}              % Enhanced list control

% Configure itemize (bullet lists)
\setlist[itemize]{
	leftmargin=20pt,               % Left margin
	itemsep=4pt plus 1pt minus 1pt, % Space between items
	parsep=2pt plus 1pt minus 1pt,  % Space between paragraphs in items
	topsep=8pt plus 2pt minus 2pt   % Space before/after list
}

% Configure enumerate (numbered lists)
\setlist[enumerate]{
	leftmargin=25pt,               % Left margin
	itemsep=4pt plus 1pt minus 1pt, % Space between items
	parsep=2pt plus 1pt minus 1pt,  % Space between paragraphs in items
	topsep=8pt plus 2pt minus 2pt   % Space before/after list
}

% Configure description lists
\setlist[description]{
	leftmargin=0pt,                % No extra left margin
	itemsep=6pt plus 2pt minus 1pt, % Space between items
	parsep=2pt plus 1pt minus 1pt,  % Space between paragraphs in items
	topsep=8pt plus 2pt minus 2pt,  % Space before/after list
	font=\bfseries\color{algorithm_blue} % Bold blue labels
}

%----------------------------------------------
% Code Block and Verbatim Spacing
%----------------------------------------------
\usepackage{fancyvrb}              % Enhanced verbatim

% Configure verbatim environments
\fvset{
	xleftmargin=15pt,              % Left margin for code blocks
	xrightmargin=15pt,             % Right margin for code blocks
	frame=leftline,                % Left border line
	framerule=2pt,                 % Border thickness
	rulecolor=\color{algorithm_blue},   % Border color
	fontsize=\small                % Font size for code
}

%----------------------------------------------
% Margin Notes and Annotations
%----------------------------------------------
\usepackage{marginnote}            % Enhanced margin notes
\renewcommand*{\marginfont}{\scriptsize\sffamily\color{textsecondary}}

% Custom margin note command
\newcommand{\sidenote}[1]{%
	\marginnote{\raggedright #1}%
}

%----------------------------------------------
% Page Breaking and Widow/Orphan Control
%----------------------------------------------

% Widow and orphan control
\widowpenalty=10000                % Prevent widows completely
\clubpenalty=10000                 % Prevent orphans completely
\brokenpenalty=7500                % Heavy penalty for hyphenated page breaks
\predisplaypenalty=10000           % Prevent breaks before display math
\postdisplaypenalty=2500           % Discourage breaks after display math
\displaywidowpenalty=3000          % Prevent display math widows

% Hyphenation control
\lefthyphenmin=3                   % Minimum chars before hyphen
\righthyphenmin=3                  % Minimum chars after hyphen

% Line breaking parameters
\linepenalty=10                    % Penalty for each line in paragraph
\adjdemerits=10000                 % Penalty for consecutive lines with different tightness

% Page breaking preferences
\raggedbottom                      % Allow flexible page endings
\flushbottom                       % Comment out raggedbottom for justified pages


%----------------------------------------------
% Table of Contents and Lists
%----------------------------------------------
\usepackage{tocloft}
\usepackage{titletoc}              % Advanced TOC formatting

% TOC spacing and visual hierarchy
\setlength{\cftbeforetoctitleskip}{0pt}
\setlength{\cftaftertoctitleskip}{3ex}
\setlength{\cftbeforepartskip}{2ex plus 0.5ex}
\setlength{\cftbeforechapskip}{1.2ex plus 0.3ex}
\setlength{\cftbeforesecskip}{0.8ex plus 0.2ex}
\setlength{\cftbeforesubsecskip}{0.4ex plus 0.1ex}
\setlength{\cftchapnumwidth}{3em}  % Default is 1.5em, increase for 3-digit chapters
\setlength{\cftsecnumwidth}{3em}   % For sections
\setlength{\cftsubsecnumwidth}{3.5em} % For subsections
% Part entries in TOC
\renewcommand{\cftpartfont}{\Large\sffamily\bfseries\color{algorithm_blue}}
\renewcommand{\cftpartpagefont}{\Large\sffamily\bfseries\color{algorithm_blue}}
\renewcommand{\cftpartleader}{\cftdotfill{\cftpartdotsep}}
\renewcommand{\cftpartdotsep}{4.5}

% Chapter entries in TOC
\renewcommand{\cftchapfont}{\large\sffamily\bfseries\color{algorithm_navy}}
\renewcommand{\cftchappagefont}{\large\sffamily\bfseries\color{algorithm_navy}}
\renewcommand{\cftchapleader}{\cftdotfill{\cftchapdotsep}}
\renewcommand{\cftchapdotsep}{2.6}

% Section entries in TOC
\renewcommand{\cftsecfont}{\sffamily\color{textprimary}}
\renewcommand{\cftsecpagefont}{\sffamily\color{textprimary}}
\renewcommand{\cftsecleader}{\cftdotfill{\cftsecdotsep}}

% Subsection entries in TOC
\renewcommand{\cftsubsecfont}{\small\sffamily\color{textsecondary}}
\renewcommand{\cftsubsecpagefont}{\small\sffamily\color{textsecondary}}

%----------------------------------------------
% Footnotes and Margin Notes
%----------------------------------------------

% Footnote formatting
\usepackage[hang,flushmargin]{footmisc}
\setlength{\footnotemargin}{1.2em}
\setlength{\footnotesep}{1ex}

% Margin notes formatting
\usepackage{marginnote}
\renewcommand*{\marginfont}{\scriptfontsize\sourcesanspro\color{secondarytext}}