%----------------------------------------------
% Page Styles and Headers/Footers
%----------------------------------------------
\usepackage{fancyhdr}              % Enhanced header/footer control
\usepackage{lastpage}              % For total page count reference
\usepackage{ifthen}                % Conditional formatting

%----------------------------------------------
% Clear Default Headers and Footers
%----------------------------------------------
\fancyhf{}                         % Clear all headers and footers
\renewcommand{\headrulewidth}{0pt} % Remove default header rule
\renewcommand{\footrulewidth}{0pt} % Remove default footer rule


%----------------------------------------------
% Custom Decorative Elements
%----------------------------------------------
% Primary header rule with gradient effect
\newcommand{\headerrule}{%
	\vbox to 0pt{%
		\vss%
		\hbox to \headwidth{%
			\textcolor{algorithm_blue}{\leaders\hrule height 1.2pt\hfill}%
		}%
		\vskip 0.2pt%
		\hbox to \headwidth{%
			\textcolor{algorithm_lightblue}{\leaders\hrule height 0.4pt\hfill}%
		}%
		\vskip 2pt%
	}%
}

% Elegant footer rule
\newcommand{\footerrule}{%
	\vbox to 0pt{%
		\vskip -4pt%
		\hbox to \headwidth{%
			\textcolor{algorithm_gray!40}{\leaders\hrule height 0.6pt\hfill}%
		}%
		\vss%
	}%
}

% Decorative rule for special pages
\newcommand{\decorativeseparator}{%
	\textcolor{algorithm_blue}{\rule{8pt}{0.8pt}}%
	\,\textcolor{algorithm_lightblue}{\textbullet}\,%
	\textcolor{algorithm_blue}{\rule{8pt}{0.8pt}}%
}
%----------------------------------------------
% Header and Footer Font Definitions
%----------------------------------------------
\newcommand{\headertitlefont}{\sffamily\footnotesize\scshape}
\newcommand{\pagenumberfont}{\sffamily\small\bfseries}
\newcommand{\creditfont}{\sffamily\tiny\itshape}

%----------------------------------------------
% Main Page Style (for regular content pages)
%----------------------------------------------
\fancypagestyle{main}{
	\fancyhf{} % Clear all
	
	% Headers for odd pages (right-hand pages)
	 % Odd pages (right-hand, recto)
	\fancyhead[RO]{%
		\parbox[b]{\textwidth}{%
			% Section title on right
			\raggedleft%
			\headerfont\color{algorithm_navy}%
			{\nouppercase{\rightmark}}%
			\vskip 2pt%
		}%
	}
 \fancyhead[LO]{%
	\parbox[b]{\textwidth}{%
		% Book title on left  
		\raggedright%
		\headertitlefont\color{algorithm_blue}%
		\textsc{\PDFTitle}%
		\vskip 2pt%
	}%
}

% Even pages (left-hand, verso)
\fancyhead[LE]{%
	\parbox[b]{\textwidth}{%
		% Chapter title on left
		\raggedright%
		\headerfont\color{algorithm_navy}%
		{\nouppercase{\leftmark}}%
		\vskip 2pt%
	}%
}

\fancyhead[RE]{%
	\parbox[b]{\textwidth}{%
		% Book acronym on right
		\raggedleft%
		\headertitlefont\color{algorithm_blue}%
		\textsc{\PDFTitle}\ \textcolor{algorithm_gray}{\textbullet}\ \textsc{First Edition}%
		\vskip 2pt%
	}%
}
	
% === FOOTERS ===
% Page numbers with progress indicators
\fancyfoot[LE]{%
	\footerfont\color{algorithm_blue}%
	\textbf{\large\thepage}%
	\textcolor{algorithm_gray}{\,\textbar\,}%
	\textcolor{textsecondary}{\pageref{LastPage}}%
}

\fancyfoot[RO]{%
	\footerfont\color{algorithm_blue}%
	\textbf{\large\thepage}%
	\textcolor{algorithm_gray}{\,\textbar\,}%
	\textcolor{textsecondary}{\pageref{LastPage}}%
}

% Author and edition info
\fancyfoot[RE]{%
	\creditfont\color{textsecondary}%
	\textit{Mahdi}\ \textcolor{algorithm_gray}{\textbullet}\ %
	\textit{Open Source}\ \textcolor{algorithm_gray}{\textbullet}\ %
	\textit{MIT License}%
}
 \fancyfoot[LO]{%
	\creditfont\color{textsecondary}%
	\textit{First Edition}\ \textcolor{algorithm_gray}{\textbullet}\ %
	\textit{\the\year}%
}

	% Custom header and footer rules
	\renewcommand{\headrulewidth}{0.6pt}
	\renewcommand{\footrulewidth}{0.4pt}
	\renewcommand{\headrule}{\hbox to\headwidth{\color{myblue}\leaders\hrule height \headrulewidth\hfill}}
	\renewcommand{\footrule}{\hbox to\headwidth{\color{gray!50}\leaders\hrule height \footrulewidth\hfill}}
}

%----------------------------------------------
% Chapter Opening Pages Style
%----------------------------------------------
\fancypagestyle{chapter}{
	\fancyhf{} % Clear all
	\renewcommand{\headrulewidth}{0pt} % No header rule
	\renewcommand{\footrulewidth}{0.4pt} % Keep footer rule
	
	% Minimal footer for chapter opening pages
	\fancyfoot[C]{%
		\footerfont\color{algorithm_blue}%
		\decorativerule\quad%
		\textbf{\large\thepage}%
		\quad\decorativerule%
	}
		\renewcommand{\footrule}{\hbox to\headwidth{\color{algorithm_lightblue}\leaders\hrule height \footrulewidth\hfill}}
	
}

%----------------------------------------------
% Front Matter Style (TOC, Preface, etc.)
%----------------------------------------------
\fancypagestyle{frontmatter}{
	% Simple centered header
	\fancyhead[C]{%
		\headerfont\color{headercolor}%
		\textsc{\PDFTitleFront}%
	}
	
	
	% Roman numeral page numbers
	\fancyfoot[C]{%
		\pagenotefont\color{footergray}%
		\textbf{\thepage}%
	}
	
	% Lighter rules for front matter
	\renewcommand{\headrule}{
		\color{headercolor!70}\hrule width\headwidth height\headrulewidth
	}
	\renewcommand{\footrule}{
		\color{footergray!50}\hrule width\headwidth height\footrulewidth
	}
}
%----------------------------------------------
% Part Opening Pages Style
%----------------------------------------------
\fancypagestyle{part}{%
	\fancyhf{} % Clear all
	\renewcommand{\headrulewidth}{0pt} % No header rule
	\renewcommand{\footrulewidth}{0pt} % No footer rule
	% Minimal footer for part pages
	\fancyfoot[C]{%
		\footerfont\color{algorithm_navy}%
		\decorativerule\quad%
		\textbf{\Large\thepage}%
		\quad\decorativerule%
	}
	
	% Footer rule
	\renewcommand{\footrule}{\hbox to\headwidth{\color{algorithm_blue}\leaders\hrule height \footrulewidth\hfill}}
}


%----------------------------------------------
% Bibliography and Index Style
%----------------------------------------------
\fancypagestyle{backmatter}{
	\fancyhf{} % Clear all
	
	% Headers 
	\fancyhead[LE,RO]{
		\headerfont\color{headerblue}{\nouppercase{\leftmark}}
	}
	\fancyhead[LO,RE]{
		\headerfont\color{textsecondary}{\textsc{\PDFTitle  \textbullet\ References}}
	}
	
	% Standard page numbers for back matter
	\fancyfoot[LE,RO]{
		\footerfont\color{footercolor}{\textbf{\thepage}}
	}
	\fancyfoot[LO,RE]{
		\footerfont\color{textsecondary}{\textit{Back Matter}}
	}
	
	% Standard rules
	\renewcommand{\headrulewidth}{0.5pt}
	\renewcommand{\footrulewidth}{0.3pt}
	\renewcommand{\headrule}{\headerrule}
	\renewcommand{\footrule}{\footerrule}
}

%----------------------------------------------
% Empty Style (for title page, copyright, etc.)
%----------------------------------------------
\fancypagestyle{empty}{
	\fancyhf{} % Completely clear
	\renewcommand{\headrulewidth}{0pt}
	\renewcommand{\footrulewidth}{0pt}
}

%----------------------------------------------
% Apply Styles Throughout Document
%----------------------------------------------

% Set main page style as default
\pagestyle{main}

% Front matter setup
\let\oldfrontmatter\frontmatter
\renewcommand{\frontmatter}{
	\oldfrontmatter
	\pagestyle{frontmatter}
}

% Main matter setup  
\let\oldmainmatter\mainmatter
\renewcommand{\mainmatter}{
	\oldmainmatter
	\pagestyle{main}
}

% Back matter setup
\let\oldbackmatter\backmatter
\renewcommand{\backmatter}{
	\oldbackmatter
	\pagestyle{backmatter}
}

%----------------------------------------------
% Custom Page Style Commands
%----------------------------------------------

% Command to return to main style
\newcommand{\mainstyle}{\pagestyle{main}}