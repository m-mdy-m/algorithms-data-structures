\newenvironment{partintro}{%
    \vspace{2em}
    \begin{center}
    \begin{minipage}{0.85\textwidth}
    \itshape\color{textgray}
    \setlength{\parskip}{0.8em}
}{%
    \end{minipage}
    \end{center}
    \vspace{2em}
}

\newenvironment{chapterintro}{%
    \vspace{1em}
    \begin{tcolorbox}[
        enhanced,
        colback=white,
        colframe=white,
        boxrule=0pt,
        borderline west={3pt}{0pt}{accent},
        sharp corners,
        left=12pt,
        right=10pt,
        top=10pt,
        bottom=10pt,
        breakable,
        before skip=10pt,
        after skip=15pt
    ]
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{0.7em}
    \color{textgray}
}{%
    \end{tcolorbox}
}

\newenvironment{sectionintro}{%
    \vspace{0.8em}
    \begin{tcolorbox}[
        enhanced,
        colback=subtle,
        colframe=subtle,
        boxrule=0pt,
        sharp corners,
        left=10pt,
        right=10pt,
        top=8pt,
        bottom=8pt,
        breakable,
        before skip=8pt,
        after skip=12pt
    ]
    \small\itshape\color{textgray}
}{%
    \end{tcolorbox}
}

\newenvironment{subsectionintro}{%
    \vspace{0.5em}
    \begin{quote}
    \small\itshape\color{textgray}
}{%
    \end{quote}
    \vspace{0.3em}
}

\newenvironment{keyidea}[1][Key Idea]{%
    \vspace{0.8em}
    \begin{tcolorbox}[
        enhanced,
        colback=accent!5,
        colframe=white,
        boxrule=0pt,
        borderline north={2pt}{0pt}{accent},
        sharp corners,
        left=10pt,
        right=10pt,
        top=8pt,
        bottom=8pt,
        breakable,
        fonttitle=\small\bfseries\color{accent},
        title=#1,
        attach title to upper={\par\medskip}
    ]
    \color{textgray}
}{%
    \end{tcolorbox}
    \vspace{0.5em}
}

\newenvironment{motivation}[1][Why This Matters]{%
    \vspace{0.8em}
    \begin{tcolorbox}[
        enhanced,
        colback=white,
        colframe=white,
        boxrule=0pt,
        borderline west={2pt}{0pt}{accent!60},
        sharp corners,
        left=10pt,
        right=8pt,
        top=6pt,
        bottom=6pt,
        breakable,
        fonttitle=\small\bfseries\color{accent!80},
        title=#1,
        attach title to upper={\par\smallskip}
    ]
    \small\color{textgray}
}{%
    \end{tcolorbox}
}

\newenvironment{important}[1][Important]{%
    \vspace{0.8em}
    \begin{tcolorbox}[
        enhanced,
        colback=white,
        colframe=white,
        boxrule=0pt,
        borderline west={3pt}{0pt}{red!70},
        sharp corners,
        left=10pt,
        right=8pt,
        top=6pt,
        bottom=6pt,
        breakable,
        fonttitle=\small\bfseries\color{red!70},
        title=#1,
        attach title to upper={\par\smallskip}
    ]
    \small\color{textgray}
}{%
    \end{tcolorbox}
}

\newenvironment{note}[1][Note]{%
    \vspace{0.6em}
    \begin{tcolorbox}[
        enhanced,
        colback=green!3,
        colframe=white,
        boxrule=0pt,
        borderline west={2pt}{0pt}{green!60},
        sharp corners,
        left=8pt,
        right=8pt,
        top=5pt,
        bottom=5pt,
        breakable,
        fonttitle=\small\bfseries\color{green!70!black},
        title=#1,
        attach title to upper={\par\smallskip}
    ]
    \footnotesize\color{textgray}
}{%
    \end{tcolorbox}
}

\newenvironment{warning}[1][Warning]{%
    \vspace{0.8em}
    \begin{tcolorbox}[
        enhanced,
        colback=orange!5,
        colframe=white,
        boxrule=0pt,
        borderline west={2pt}{0pt}{orange!70},
        sharp corners,
        left=10pt,
        right=8pt,
        top=6pt,
        bottom=6pt,
        breakable,
        fonttitle=\small\bfseries\color{orange!80!black},
        title=#1,
        attach title to upper={\par\smallskip}
    ]
    \small\color{textgray}
}{%
    \end{tcolorbox}
}

\newenvironment{historicalnote}[1][Historical Note]{%
    \vspace{0.8em}
    \begin{tcolorbox}[
        enhanced,
        colback=brown!5,
        colframe=white,
        boxrule=0pt,
        borderline west={2pt}{0pt}{brown!50},
        sharp corners,
        left=10pt,
        right=8pt,
        top=6pt,
        bottom=6pt,
        breakable,
        fonttitle=\small\itshape\bfseries\color{brown!70!black},
        title=#1,
        attach title to upper={\par\smallskip}
    ]
    \small\color{textgray}
}{%
    \end{tcolorbox}
}

\newenvironment{connection}[1][Connection]{%
    \vspace{0.6em}
    \begin{tcolorbox}[
        enhanced,
        colback=purple!3,
        colframe=white,
        boxrule=0pt,
        borderline west={2pt}{0pt}{purple!60},
        sharp corners,
        left=8pt,
        right=8pt,
        top=5pt,
        bottom=5pt,
        breakable,
        fonttitle=\small\bfseries\color{purple!70!black},
        title=#1,
        attach title to upper={\par\smallskip}
    ]
    \footnotesize\color{textgray}
}{%
    \end{tcolorbox}
}